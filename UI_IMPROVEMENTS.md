# UI 改进说明

## 工具调用展示优化

### 新增功能

1. **可折叠的工具调用面板**
   - 每个工具调用都使用可折叠的 Accordion 面板展示
   - 点击面板标题可以展开/折叠详细内容
   - 展开的内容背景使用浅灰色，提供良好的视觉层次

2. **状态图标和颜色**
   - ✅ 执行完成：绿色勾选图标
   - 🔧 正在执行：蓝色时钟图标
   - ❌ 执行失败：红色警告图标
   - ⚙️ 等待执行：灰色扳手图标

3. **详细内容展示**
   - **输入参数**：显示工具调用的输入参数，支持复制功能
   - **工具输出**：显示工具执行的结果，支持复制功能
   - **状态信息**：执行中显示加载动画，失败时显示错误信息

4. **交互功能**
   - 一键复制 JSON 内容到剪贴板
   - 平滑的展开/折叠动画效果
   - 响应式设计，适配不同屏幕尺寸

### 技术实现

- 新增 `ToolCallPanel.tsx` 组件
- 修改 `MemoizedMessage.tsx` 组件以支持工具消息的特殊渲染
- 使用 Framer Motion 实现流畅的动画效果
- 集成 Tailwind CSS 实现现代化的 UI 设计

### 使用方法

工具调用消息会自动使用新的面板组件，无需额外配置。当 WebSocket 服务器发送工具状态更新时，UI 会自动渲染为可折叠的面板。

### 修复的问题

1. **工具执行状态显示**：点击"正在执行:xxx"时，现在会显示函数的输入参数，而不是重复显示"正在执行工具: xxx"
2. **JSON 格式渲染**：改进了 JSON 内容的显示格式，支持自动换行、语法高亮和更好的可读性
3. **输入参数展示**：在工具执行过程中，可以查看传递给工具的具体参数
4. **ADK 兼容性**：修复了输入参数获取问题，现在支持多种字段格式（`args`、`input_params`、`tool_input`、`function_call.args`）
5. **智能内容显示**：
   - 工具执行中：显示输入参数
   - 工具完成时：显示工具输出结果
   - 避免重复显示状态信息
6. **特殊工具处理**：
   - `transfer_to_agent` 工具：不展示参数和返回内容
   - 其他工具：智能提取 TextContent 中的 text 内容

### 样式规范

- **面板标题**：白色背景，悬停时变为浅灰色
- **展开内容**：浅灰色背景 (`bg-gray-100`)，提供良好的视觉层次
- **状态颜色**：根据执行状态使用不同的颜色（绿色、蓝色、红色、灰色）
- **边框和圆角**：统一的边框样式和圆角设计

### 兼容性

- 完全向后兼容现有的消息格式
- 支持深色模式
- 响应式设计，适配移动端和桌面端 